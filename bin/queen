#!/usr/bin/env node

var app = require('commander'),
	queenRunner = require('../lib/server/runner.js'),
	startThrill = true,
	config = {};

app.version('0.3.0');
	
app.option('-h, --host [host]', 'The host to bind the remote server to')
	.option('--httpHost [hostname]', 'The host ot bind the http server to for capturing browsers', parseInt)
	.option('--heartbeatInterval <n>', 'Milliseconds clients have to send a heartbeat until deemed unresponsive', parseInt)
	.option('-v, --verbose', 'Whether to log verbosely')
	.option('-q, --quiet', 'Don\'t output anything to output stream');

app.command("*","hi").action(function(filePath){
	var args = Array.prototype.slice.call(arguments, 0);
	// Discard the last arg, which is commander
	args.pop();
	
	config.file = args[0];
});

app.on('--help', function(){
  console.log('  Examples:');
  console.log('');
  console.log('  Start queen with default options:');
  console.log('    $ queen');
  console.log('');
  console.log('  Run a JavaScript file, adding in a "queen" global variable:');
  console.log('    $ queen my-queen-script.js');
  console.log('');
  console.log('  Start a queen server on the hostname "queen.turn.com", listening to port 9564 for runners:');
  console.log('    $ queen -h queen.turn.com:9564');
  console.log('');
});

app.parse(process.argv);

if(!startThrill) return;

config.host = app.host;
config.quiet = app.quiet;
config.verbose = app.verbose;

queenRunner(config);